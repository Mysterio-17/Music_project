<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lobby Room</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">


  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
  body {
    font-family: 'Chewy', cursive;
  }
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -10;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body class="bg-gray-900 text-white h-screen overflow-hidden relative">
  <header class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50">
  <img src="/images/BeatQuest (2).png" alt="BeatQuest Logo" class="h-60" />
</header>

  <div id="particles-js" class="fixed top-0 left-0 w-full h-full -z-10"></div>

  <div class="absolute top-6 right-6 bg-gray-800 px-6 py-4 rounded-lg shadow-lg w-[250px]">
    <h2 class="text-lg font-bold mb-2">üë• Players in Lobby</h2>
    <ul id="playersUl" class="list-disc list-inside space-y-1 text-sm"></ul>
  </div>

  <div class="flex flex-col items-center justify-center h-full">
    <h1 class="text-3xl font-bold mb-2 text-pink-400">üéµ Lobby Room</h1>
    <p id="roomCode" class="mb-6 text-yellow-300 font-semibold"></p>

    <div class="flex flex-col items-center w-[500px] max-w-full">
      <input id="playlistInput" type="text" placeholder="Paste YouTube Playlist URL"
        class="w-full px-4 py-2 mb-4 rounded-md text-black" />

      <button id="loadPlaylistBtn"
        class="w-[250px] bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded mb-3">
        üé∂ Load Playlist
      </button>

      <button id="startGameBtn"
        class="w-[250px]  bg-green-500 hover:bg-green-600 px-4 py-2 rounded hidden">
        ‚ñ∂Ô∏è Start Game
      </button>
    </div>
  </div>

  <script>
    const socket = io();
    const urlParams = new URLSearchParams(window.location.search);
    const roomCode = urlParams.get("room");
    const isHost = urlParams.get("host") === "true";
    const username = urlParams.get("username");

    socket.emit("joinRoom", { username, roomCode });

    document.getElementById("roomCode").innerText = `Room Code: ${roomCode}`;

    if (isHost) {
      document.getElementById("startGameBtn").classList.remove("hidden");
    }

    document.getElementById("startGameBtn").onclick = () => {
      socket.emit("startGame", { roomCode: roomCode });
      console.log("üöÄ startGame emitted to server");
    };

    document.getElementById("loadPlaylistBtn").onclick = () => {
      const url = document.getElementById("playlistInput").value.trim();
      if (!url) return alert("Paste a playlist URL");
      const playlistId = extractPlaylistId(url);
      if (!playlistId) return alert("Invalid playlist URL");
      socket.emit("loadPlaylist", { playlistId, room: roomCode });
    };

    function extractPlaylistId(url) {
      const match = url.match(/[?&]list=([a-zA-Z0-9_-]+)/);
      return match ? match[1] : null;
    }

    socket.on("gameStarted", () => {
      console.log("Game started! Redirecting to game.html");
      window.location.href = `/game.html?room=${roomCode}&username=${username}`;
    });

    socket.on("updatePlayers", (usernames) => {
      const playersUl = document.getElementById("playersUl");
      playersUl.innerHTML = '';
      usernames.forEach(name => {
        const li = document.createElement("li");
        li.textContent = name;
        playersUl.appendChild(li);
      });
    });
  </script>

  <script>
    particlesJS("particles-js", {
      particles: {
        number: { value: 100 },
        size: { value: 2 },
        color: { value: "#ffffff" },
        opacity: { value: 0.7 },
        move: { speed: 0.3 },
        line_linked: { enable: false }
      },
      interactivity: {
        detect_on: "canvas",
        events: { onhover: { enable: false }, onclick: { enable: false } }
      }
    });
  </script>
</body>
</html>
